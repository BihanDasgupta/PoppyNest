<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Journal - PoppyNest</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Nightlamp -->
  <div class="nightlamp" id="nightlamp">
    <div class="nightlamp-base"></div>
    <div class="nightlamp-stand"></div>
    <div class="nightlamp-shade"></div>
    <div class="nightlamp-bulb"></div>
  </div>
  
  <!-- Light overlay -->
  <div class="light-overlay" id="lightOverlay"></div>
  
  <!-- Floating flower elements for dark mode -->
  <div class="floating-emoji-1">🌸</div>
  <div class="floating-emoji-2">🌸</div>
  <div class="floating-emoji-3">🌸</div>
  <div class="floating-emoji-4">🌸</div>
  <div class="floating-emoji-5">🌸</div>
  <div class="floating-emoji-6">🌸</div>
  <div class="floating-emoji-7">🌸</div>
  <div class="floating-emoji-8">🌸</div>
  <div class="floating-emoji-9">🌸</div>
  <div class="floating-emoji-10">🌸</div>
  <div class="floating-emoji-11">🌸</div>
  <div class="floating-emoji-12">🌸</div>
  <div class="floating-emoji-13">🌸</div>
  <div class="floating-emoji-14">🌸</div>
  <div class="floating-emoji-15">🌸</div>
  <div class="floating-emoji-16">🌸</div>
  <div class="floating-emoji-17">🌸</div>
  <div class="floating-emoji-18">🌸</div>
  <div class="floating-emoji-19">🌸</div>
  <div class="floating-emoji-20">🌸</div>
  <!-- Floating star elements for dark mode -->
  <div class="floating-star-1">⭐</div>
  <div class="floating-star-2">⭐</div>
  <div class="floating-star-3">⭐</div>
  <div class="floating-star-4">⭐</div>
  <div class="floating-star-5">⭐</div>
  <div class="floating-star-6">⭐</div>
  <div class="floating-star-7">⭐</div>
  <div class="floating-star-8">⭐</div>
  <div class="floating-star-9">⭐</div>
  <div class="floating-star-10">⭐</div>
  <div class="floating-star-11">⭐</div>
  <div class="floating-star-12">⭐</div>
  <div class="floating-star-13">⭐</div>
  <div class="floating-star-14">⭐</div>
  <div class="floating-star-15">⭐</div>
  <div class="floating-star-16">⭐</div>
  <div class="floating-star-17">⭐</div>
  <div class="floating-star-18">⭐</div>
  <div class="floating-star-19">⭐</div>
  <div class="floating-star-20">⭐</div>
  <div class="floating-star-21">⭐</div>
  <div class="floating-star-22">⭐</div>
  <div class="floating-star-23">⭐</div>
  <div class="floating-star-24">⭐</div>
  <div class="floating-star-25">⭐</div>
  <div class="floating-star-26">⭐</div>
  <div class="floating-star-27">⭐</div>
  <div class="floating-star-28">⭐</div>
  <div class="floating-star-29">⭐</div>
  <div class="floating-star-30">⭐</div>
  <div class="floating-star-31">⭐</div>
  <div class="floating-star-32">⭐</div>
  <div class="floating-star-33">⭐</div>
  <div class="floating-star-34">⭐</div>
  <div class="floating-star-35">⭐</div>
  <div class="floating-star-36">⭐</div>
  <div class="floating-star-37">⭐</div>
  <div class="floating-star-38">⭐</div>
  <div class="floating-star-39">⭐</div>
  <div class="floating-star-40">⭐</div>
  <div class="app-container">
    <header>
      <h1 class="interactive-title">
        <span class="emoji">📝</span>
        <span class="letter" data-letter="J">J</span>
        <span class="letter" data-letter="o">o</span>
        <span class="letter" data-letter="u">u</span>
        <span class="letter" data-letter="r">r</span>
        <span class="letter" data-letter="n">n</span>
        <span class="letter" data-letter="a">a</span>
        <span class="letter" data-letter="l">l</span>
      </h1>
      <p>What's on your mind? Write it out ☺️</p>
    </header>

    <main class="journal-container">
      <button class="new-page-btn" onclick="addNewPage()">📄 New Entry</button>
      
      <div id="delete-modal" class="delete-modal fixed-top-modal" style="display:none;">
        <div class="delete-modal-content">
          <p id="delete-modal-text">Are you sure you want to delete this entry?</p>
          <div class="delete-modal-actions">
            <button id="confirm-delete-btn" class="delete-confirm-btn">Delete</button>
            <button id="cancel-delete-btn" class="delete-cancel-btn">Cancel</button>
          </div>
        </div>
      </div>

      <div class="entries-scrollbox" style="max-width: 900px !important;">
        <div id="journal-pages" class="journal-pages" style="max-width: 900px !important;">
          <!-- Journal pages will be dynamically added here -->
        </div>
      </div>
      
      <div class="button-group">
        <button id="goodnight-toggle" class="goodnight-btn" onclick="toggleGoodnightMode()">🌙 Goodnight Mode</button>
      </div>
    </main>

    <nav class="nav-buttons">
      <a href="index.html">← Back to Chat</a>
      <a href="draw.html">🎨 Draw</a>
      <a href="dreams.html">💤 Dream Log</a>
    </nav>
  </div>

  <script>
    let goodnightMode = false;
    let journalPages = [];
    let pageToDelete = null;

    function showDeleteModal(pageId) {
      pageToDelete = pageId;
      document.getElementById('delete-modal').style.display = 'flex';
    }
    function hideDeleteModal() {
      pageToDelete = null;
      document.getElementById('delete-modal').style.display = 'none';
    }
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('confirm-delete-btn').onclick = function() {
        if (pageToDelete !== null) {
          journalPages = journalPages.filter(p => p.id !== pageToDelete);
          saveJournalPages();
          renderJournalPages();
        }
        hideDeleteModal();
      };
      document.getElementById('cancel-delete-btn').onclick = function() {
        hideDeleteModal();
      };
    });

    function addNewPage() {
      const newPage = {
        id: Date.now(),
        date: new Date().toLocaleString(),
        content: '',
        isEditing: true
      };
      
      journalPages.unshift(newPage);
      saveJournalPages();
      renderJournalPages();
      
      // Focus on the new page's textarea
      setTimeout(() => {
        const newTextarea = document.querySelector(`[data-page-id="${newPage.id}"] textarea`);
        if (newTextarea) newTextarea.focus();
      }, 100);
    }

    function editPage(pageId) {
      const page = journalPages.find(p => p.id === pageId);
      if (page) {
        page.isEditing = true;
        renderJournalPages();
        
        setTimeout(() => {
          const textarea = document.querySelector(`[data-page-id="${pageId}"] textarea`);
          if (textarea) textarea.focus();
        }, 100);
      }
    }

    function savePage(pageId) {
      const page = journalPages.find(p => p.id === pageId);
      const textarea = document.querySelector(`[data-page-id="${pageId}"] textarea`);
      
      if (page && textarea) {
        page.content = textarea.value;
        page.isEditing = false;
        saveJournalPages();
        renderJournalPages();
      }
    }

    function deletePage(pageId) {
      showDeleteModal(pageId);
    }

    function renderJournalPages() {
      const container = document.getElementById('journal-pages');
      container.innerHTML = '';
      
      if (journalPages.length === 0) {
        container.innerHTML = '<div class="journal-empty">No entries yet. Click "New Entry" to start writing! 📝</div>';
        return;
      }
      
      journalPages.forEach(page => {
        const pageElement = document.createElement('div');
        pageElement.className = 'journal-page';
        pageElement.setAttribute('data-page-id', page.id);
        
        if (page.isEditing) {
          pageElement.innerHTML = `
            <div class="journal-page-header">
              <span class="journal-page-date">${page.date}</span>
              <span>✏️ Editing</span>
            </div>
            <textarea 
              placeholder="Write your thoughts here..." 
              style="width: 100%; min-height: 150px; margin: 0;"
            >${page.content}</textarea>
            <div class="journal-page-actions">
              <button onclick="savePage(${page.id})">💾 Save</button>
              <button onclick="deletePage(${page.id})" style="background: #ff6b6b;">🗑️ Delete</button>
            </div>
          `;
        } else {
          pageElement.innerHTML = `
            <div class="journal-page-header">
              <span class="journal-page-date">${page.date}</span>
              <span>📖 Entry</span>
            </div>
            <div class="journal-page-content">${page.content || 'No content yet...'}</div>
            <div class="journal-page-actions">
              <button onclick="editPage(${page.id})">✏️ Edit</button>
              <button onclick="deletePage(${page.id})" style="background: #ff6b6b;">🗑️ Delete</button>
            </div>
          `;
        }
        
        container.appendChild(pageElement);
      });
    }

    function saveJournalPages() {
      localStorage.setItem("journalPages", JSON.stringify(journalPages));
    }

    function loadJournalPages() {
      const saved = localStorage.getItem("journalPages");
      if (saved) {
        journalPages = JSON.parse(saved);
      }
    }

    function toggleGoodnightMode() {
      const btn = document.getElementById("goodnight-toggle");
      const body = document.body;

      goodnightMode = !goodnightMode;

      if (goodnightMode) {
        body.classList.add("cyber-night");
        localStorage.setItem("goodnightMode", "true");
        btn.textContent = "⭐ Rise and Shine";
      } else {
        body.classList.remove("cyber-night");
        localStorage.setItem("goodnightMode", "false");
        btn.textContent = "🌙 Goodnight Mode";
      }
    }

    // Initialize interactive title
    function initInteractiveTitle() {
      const letters = document.querySelectorAll('.interactive-title .letter');
      console.log('Initializing interactive title with', letters.length, 'letters');
      
      letters.forEach(letter => {
        letter.addEventListener('mouseenter', (e) => {
          console.log('Letter hovered:', e.target.textContent);
          // Add floating particles effect
          createFloatingParticles(e.target);
        });
      });
    }

    // Create floating particles around the letter
    function createFloatingParticles(letterElement) {
      const rect = letterElement.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      
      for (let i = 0; i < 5; i++) {
        const particle = document.createElement('div');
        particle.className = 'floating-particle';
        particle.style.cssText = `
          position: fixed;
          left: ${centerX}px;
          top: ${centerY}px;
          width: 4px;
          height: 4px;
          background: #ff1493;
          border-radius: 50%;
          pointer-events: none;
          z-index: 1000;
          animation: particleFloat 1s ease-out forwards;
        `;
        
        document.body.appendChild(particle);
        
        // Remove particle after animation
        setTimeout(() => {
          if (particle.parentNode) {
            particle.parentNode.removeChild(particle);
          }
        }, 1000);
      }
    }

    // Initialize nightlamp
    function initNightlamp() {
      const nightlamp = document.getElementById('nightlamp');
      const lightOverlay = document.getElementById('lightOverlay');
      let isLampOn = false;

      // Load saved state
      const savedLampState = localStorage.getItem('nightlampOn');
      if (savedLampState === 'true') {
        isLampOn = true;
        nightlamp.classList.add('on');
        lightOverlay.classList.add('active');
      }

      nightlamp.addEventListener('click', () => {
        isLampOn = !isLampOn;
        
        if (isLampOn) {
          nightlamp.classList.add('on');
          lightOverlay.classList.add('active');
          localStorage.setItem('nightlampOn', 'true');
        } else {
          nightlamp.classList.remove('on');
          lightOverlay.classList.remove('active');
          localStorage.setItem('nightlampOn', 'false');
        }
      });

      // Add hover effect with subtle glow
      nightlamp.addEventListener('mouseenter', () => {
        if (!isLampOn) {
          nightlamp.style.filter = 'brightness(1.1)';
        }
      });

      nightlamp.addEventListener('mouseleave', () => {
        if (!isLampOn) {
          nightlamp.style.filter = 'brightness(1)';
        }
      });
    }

    window.onload = () => {
      loadJournalPages();
      renderJournalPages();
      initInteractiveTitle();
      initNightlamp();
      
      // Check if we should be in goodnight mode
      const savedMode = localStorage.getItem("goodnightMode");
      if (savedMode === "true") {
        goodnightMode = true;
        document.body.classList.add("cyber-night");
        const btn = document.getElementById("goodnight-toggle");
        if (btn) btn.textContent = "⭐ Rise and Shine";
      }
      
      // Store current mode for next page load
      localStorage.setItem("previousMode", savedMode || "false");
    };

    // Auto-save all editing pages on unload
    window.addEventListener('beforeunload', () => {
      // For each editing page, update its content from the textarea
      journalPages.forEach(page => {
        if (page.isEditing) {
          const textarea = document.querySelector(`[data-page-id="${page.id}"] textarea`);
          if (textarea) {
            page.content = textarea.value;
          }
        }
      });
      saveJournalPages();
    });
  </script>
</body>
</html>
