<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dream Log - PoppyNest</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Nightlamp -->
  <div class="nightlamp" id="nightlamp">
    <div class="nightlamp-base"></div>
    <div class="nightlamp-stand"></div>
    <div class="nightlamp-shade"></div>
    <div class="nightlamp-bulb"></div>
  </div>
  
  <!-- Light overlay -->
  <div class="light-overlay" id="lightOverlay"></div>
  
  <!-- Floating flower elements for dark mode -->
  <div class="floating-emoji-1">🌸</div>
  <div class="floating-emoji-2">🌸</div>
  <div class="floating-emoji-3">🌸</div>
  <div class="floating-emoji-4">🌸</div>
  <div class="floating-emoji-5">🌸</div>
  <div class="floating-emoji-6">🌸</div>
  <div class="floating-emoji-7">🌸</div>
  <div class="floating-emoji-8">🌸</div>
  <div class="floating-emoji-9">🌸</div>
  <div class="floating-emoji-10">🌸</div>
  <div class="floating-emoji-11">🌸</div>
  <div class="floating-emoji-12">🌸</div>
  <div class="floating-emoji-13">🌸</div>
  <div class="floating-emoji-14">🌸</div>
  <div class="floating-emoji-15">🌸</div>
  <div class="floating-emoji-16">🌸</div>
  <div class="floating-emoji-17">🌸</div>
  <div class="floating-emoji-18">🌸</div>
  <div class="floating-emoji-19">🌸</div>
  <div class="floating-emoji-20">🌸</div>
  <!-- Floating star elements for dark mode -->
  <div class="floating-star-1">⭐</div>
  <div class="floating-star-2">⭐</div>
  <div class="floating-star-3">⭐</div>
  <div class="floating-star-4">⭐</div>
  <div class="floating-star-5">⭐</div>
  <div class="floating-star-6">⭐</div>
  <div class="floating-star-7">⭐</div>
  <div class="floating-star-8">⭐</div>
  <div class="floating-star-9">⭐</div>
  <div class="floating-star-10">⭐</div>
  <div class="floating-star-11">⭐</div>
  <div class="floating-star-12">⭐</div>
  <div class="floating-star-13">⭐</div>
  <div class="floating-star-14">⭐</div>
  <div class="floating-star-15">⭐</div>
  <div class="floating-star-16">⭐</div>
  <div class="floating-star-17">⭐</div>
  <div class="floating-star-18">⭐</div>
  <div class="floating-star-19">⭐</div>
  <div class="floating-star-20">⭐</div>
  <div class="floating-star-21">⭐</div>
  <div class="floating-star-22">⭐</div>
  <div class="floating-star-23">⭐</div>
  <div class="floating-star-24">⭐</div>
  <div class="floating-star-25">⭐</div>
  <div class="floating-star-26">⭐</div>
  <div class="floating-star-27">⭐</div>
  <div class="floating-star-28">⭐</div>
  <div class="floating-star-29">⭐</div>
  <div class="floating-star-30">⭐</div>
  <div class="floating-star-31">⭐</div>
  <div class="floating-star-32">⭐</div>
  <div class="floating-star-33">⭐</div>
  <div class="floating-star-34">⭐</div>
  <div class="floating-star-35">⭐</div>
  <div class="floating-star-36">⭐</div>
  <div class="floating-star-37">⭐</div>
  <div class="floating-star-38">⭐</div>
  <div class="floating-star-39">⭐</div>
  <div class="floating-star-40">⭐</div>
  <div class="app-container">
    <header>
      <h1 class="interactive-title">
        <span class="emoji">💤</span>
        <span class="letter" data-letter="D">D</span>
        <span class="letter" data-letter="r">r</span>
        <span class="letter" data-letter="e">e</span>
        <span class="letter" data-letter="a">a</span>
        <span class="letter" data-letter="m">m</span>
        <span class="letter" data-letter="L">L</span>
        <span class="letter" data-letter="o">o</span>
        <span class="letter" data-letter="g">g</span>
      </h1>
      <p>If you don't write your dreams down you'll forget them 😔</p>
    </header>

    <main class="dream-container">
      <button class="new-page-btn" onclick="addNewDream()">🌙 New Dream</button>
      
      <div id="delete-modal" class="delete-modal fixed-top-modal" style="display:none;">
        <div class="delete-modal-content">
          <p id="delete-modal-text">Are you sure you want to delete this dream?</p>
          <div class="delete-modal-actions">
            <button id="confirm-delete-btn" class="delete-confirm-btn">Delete</button>
            <button id="cancel-delete-btn" class="delete-cancel-btn">Cancel</button>
          </div>
        </div>
      </div>

      <div class="entries-scrollbox">
        <div id="dream-pages" class="journal-pages">
          <!-- Dream pages will be dynamically added here -->
        </div>
      </div>
      
      <div class="button-group">
        <button id="goodnight-toggle" class="goodnight-btn" onclick="toggleGoodnightMode()">🌙 Goodnight Mode</button>
      </div>
    </main>

    <nav class="nav-buttons">
      <a href="index.html">← Back to Chat</a>
      <a href="journal.html">📝 Journal</a>
      <a href="draw.html">🎨 Draw</a>
    </nav>
  </div>

  <script>
    let goodnightMode = false;
    let dreamPages = [];
    let dreamToDelete = null;

    function showDeleteModal(dreamId) {
      dreamToDelete = dreamId;
      document.getElementById('delete-modal').style.display = 'flex';
    }
    function hideDeleteModal() {
      dreamToDelete = null;
      document.getElementById('delete-modal').style.display = 'none';
    }
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('confirm-delete-btn').onclick = function() {
        if (dreamToDelete !== null) {
          dreamPages = dreamPages.filter(d => d.id !== dreamToDelete);
          saveDreamPages();
          renderDreamPages();
        }
        hideDeleteModal();
      };
      document.getElementById('cancel-delete-btn').onclick = function() {
        hideDeleteModal();
      };
    });

    function addNewDream() {
      const newDream = {
        id: Date.now(),
        date: new Date().toLocaleString(),
        content: '',
        isEditing: true
      };
      
      dreamPages.unshift(newDream);
      saveDreamPages();
      renderDreamPages();
      
      // Focus on the new dream's textarea
      setTimeout(() => {
        const newTextarea = document.querySelector(`[data-dream-id="${newDream.id}"] textarea`);
        if (newTextarea) newTextarea.focus();
      }, 100);
    }

    function editDream(dreamId) {
      const dream = dreamPages.find(d => d.id === dreamId);
      if (dream) {
        dream.isEditing = true;
        renderDreamPages();
        
        setTimeout(() => {
          const textarea = document.querySelector(`[data-dream-id="${dreamId}"] textarea`);
          if (textarea) textarea.focus();
        }, 100);
      }
    }

    function saveDream(dreamId) {
      const dream = dreamPages.find(d => d.id === dreamId);
      const textarea = document.querySelector(`[data-dream-id="${dreamId}"] textarea`);
      
      if (dream && textarea) {
        dream.content = textarea.value;
        dream.isEditing = false;
        saveDreamPages();
        renderDreamPages();
      }
    }

    function deleteDream(dreamId) {
      showDeleteModal(dreamId);
    }

    function renderDreamPages() {
      const container = document.getElementById('dream-pages');
      container.innerHTML = '';
      
      if (dreamPages.length === 0) {
        container.innerHTML = '<div class="journal-empty">No dreams recorded yet. Click "New Dream" to start! 🌙</div>';
        return;
      }
      
      dreamPages.forEach(dream => {
        const dreamElement = document.createElement('div');
        dreamElement.className = 'journal-page';
        dreamElement.setAttribute('data-dream-id', dream.id);
        
        if (dream.isEditing) {
          dreamElement.innerHTML = `
            <div class="journal-page-header">
              <span class="journal-page-date">${dream.date}</span>
              <span>✏️ Editing Dream</span>
            </div>
            <textarea 
              placeholder="Describe your dream here..." 
              style="width: 100%; min-height: 150px; margin: 0;"
            >${dream.content}</textarea>
            <div class="journal-page-actions">
              <button onclick="saveDream(${dream.id})">💾 Save Dream</button>
              <button onclick="deleteDream(${dream.id})" style="background: #ff6b6b;">🗑️ Delete</button>
            </div>
          `;
        } else {
          dreamElement.innerHTML = `
            <div class="journal-page-header">
              <span class="journal-page-date">${dream.date}</span>
              <span>🌙 Dream</span>
            </div>
            <div class="journal-page-content">${dream.content || 'No dream content yet...'}</div>
            <div class="journal-page-actions">
              <button onclick="editDream(${dream.id})">✏️ Edit</button>
              <button onclick="deleteDream(${dream.id})" style="background: #ff6b6b;">🗑️ Delete</button>
            </div>
          `;
        }
        
        container.appendChild(dreamElement);
      });
    }

    function saveDreamPages() {
      localStorage.setItem("dreamPages", JSON.stringify(dreamPages));
    }

    function loadDreamPages() {
      const saved = localStorage.getItem("dreamPages");
      if (saved) {
        dreamPages = JSON.parse(saved);
      }
    }

    function toggleGoodnightMode() {
      const btn = document.getElementById("goodnight-toggle");
      const body = document.body;

      goodnightMode = !goodnightMode;

      if (goodnightMode) {
        body.classList.add("cyber-night");
        localStorage.setItem("goodnightMode", "true");
        btn.textContent = "⭐ Rise and Shine";
      } else {
        body.classList.remove("cyber-night");
        localStorage.setItem("goodnightMode", "false");
        btn.textContent = "🌙 Goodnight Mode";
      }
    }

    // Initialize interactive title
    function initInteractiveTitle() {
      const letters = document.querySelectorAll('.interactive-title .letter');
      
      letters.forEach(letter => {
        letter.addEventListener('mouseenter', (e) => {
          // Add floating particles effect
          createFloatingParticles(e.target);
        });
      });
    }

    // Create floating particles around the letter
    function createFloatingParticles(letterElement) {
      const rect = letterElement.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      
      for (let i = 0; i < 5; i++) {
        const particle = document.createElement('div');
        particle.className = 'floating-particle';
        particle.style.cssText = `
          position: fixed;
          left: ${centerX}px;
          top: ${centerY}px;
          width: 4px;
          height: 4px;
          background: #ff1493;
          border-radius: 50%;
          pointer-events: none;
          z-index: 1000;
          animation: particleFloat 1s ease-out forwards;
        `;
        
        document.body.appendChild(particle);
        
        // Remove particle after animation
        setTimeout(() => {
          if (particle.parentNode) {
            particle.parentNode.removeChild(particle);
          }
        }, 1000);
      }
    }

    // Initialize nightlamp
    function initNightlamp() {
      const nightlamp = document.getElementById('nightlamp');
      const lightOverlay = document.getElementById('lightOverlay');
      let isLampOn = false;

      // Load saved state
      const savedLampState = localStorage.getItem('nightlampOn');
      if (savedLampState === 'true') {
        isLampOn = true;
        nightlamp.classList.add('on');
        lightOverlay.classList.add('active');
      }

      nightlamp.addEventListener('click', () => {
        isLampOn = !isLampOn;
        
        if (isLampOn) {
          nightlamp.classList.add('on');
          lightOverlay.classList.add('active');
          localStorage.setItem('nightlampOn', 'true');
        } else {
          nightlamp.classList.remove('on');
          lightOverlay.classList.remove('active');
          localStorage.setItem('nightlampOn', 'false');
        }
      });

      // Add hover effect with subtle glow
      nightlamp.addEventListener('mouseenter', () => {
        if (!isLampOn) {
          nightlamp.style.filter = 'brightness(1.1)';
        }
      });

      nightlamp.addEventListener('mouseleave', () => {
        if (!isLampOn) {
          nightlamp.style.filter = 'brightness(1)';
        }
      });
    }

    window.onload = () => {
      loadDreamPages();
      renderDreamPages();
      initInteractiveTitle();
      initNightlamp();
      
      // Check if we should be in goodnight mode
      const savedMode = localStorage.getItem("goodnightMode");
      if (savedMode === "true") {
        goodnightMode = true;
        document.body.classList.add("cyber-night");
        const btn = document.getElementById("goodnight-toggle");
        if (btn) btn.textContent = "⭐ Rise and Shine";
      }
      
      // Store current mode for next page load
      localStorage.setItem("previousMode", savedMode || "false");
    };
  </script>
</body>
</html>
